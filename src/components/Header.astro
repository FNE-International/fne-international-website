---
interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Props {
  breadcrumbs?: BreadcrumbItem[];
}

const { breadcrumbs = [] } = Astro.props;

const navItems = [
  { label: 'About', href: '/about', children: [
    { label: 'Our Story', href: '/about/our-story' },
    { label: 'Our Team', href: '/about/team' },
    { label: 'Our Approach', href: '/about/approach' },
  ]},
  { label: 'Programs', href: '/programs', children: [
    { label: 'Nicaragua', href: '/programs/nicaragua' },
    { label: 'Peru', href: '/programs/peru' },
    { label: 'Dominican Republic', href: '/programs/dominican-republic' },
  ]},
  { label: 'Get Involved', href: '/get-involved', children: [
    { label: 'Volunteer Trips', href: '/get-involved/trips' },
    { label: 'Remote Volunteering', href: '/get-involved/remote' },
    { label: 'Internships', href: '/get-involved/internships' },
  ]},
  { label: 'Hope Collective', href: '/hope-collective' },
  { label: 'Blog', href: '/blog' },
  { label: 'Contact', href: '/contact' },
];

const hasBreadcrumbs = breadcrumbs.length > 0;
---

<header class="header-wrapper sticky top-0 z-50">
  <div class="header-main bg-white shadow-sm">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
      <div class="flex justify-between items-center h-[88px]">
        <!-- Logo -->
        <a href="/" class="flex items-center">
          <img src="/logo.avif" alt="FNE International - Pathways Out of Poverty, go to homepage" class="h-12 w-auto" />
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-8" role="menubar">
          {navItems.map((item) => (
            <div class="relative group" role="none">
              <a
                href={item.href}
                class="nav-link text-gray-700 hover:text-[#2D8B4E] font-medium py-4 inline-flex items-center"
                role="menuitem"
                aria-haspopup={item.children ? "true" : undefined}
                aria-expanded={item.children ? "false" : undefined}
              >
                {item.label}
                {item.children && (
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                )}
              </a>
              {item.children && (
                <div class="dropdown-menu" role="menu" aria-label={`${item.label} submenu`}>
                  {item.children.map((child) => (
                    <a
                      href={child.href}
                      class="block px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-100 hover:text-[#2D8B4E]"
                      role="menuitem"
                    >
                      {child.label}
                    </a>
                  ))}
                </div>
              )}
            </div>
          ))}
          <a
            href="/donate"
            class="bg-[#F7931E] text-white px-6 py-2 rounded-lg font-semibold hover:bg-[#e8850f] transition-colors"
            role="menuitem"
          >
            Donate
          </a>
        </div>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          class="md:hidden p-3 -mr-2 text-gray-700 min-w-[44px] min-h-[44px] flex items-center justify-center"
          aria-label="Open navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </nav>
  </div>

  <!-- Breadcrumb Bar (visible on scroll) -->
  {hasBreadcrumbs && (
    <nav id="breadcrumb-bar" class="breadcrumb-bar" aria-label="Breadcrumb">
      <div class="breadcrumb-bar-inner">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <ol class="breadcrumb-content" role="list">
            <li class="inline-flex items-center">
              <a href="/" class="breadcrumb-item breadcrumb-home">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span class="sr-only">Home</span>
              </a>
            </li>
            {breadcrumbs.map((item, index) => (
              <li class="inline-flex items-center">
                <svg class="breadcrumb-separator" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
                {item.href && index < breadcrumbs.length - 1 ? (
                  <a href={item.href} class="breadcrumb-item">{item.label}</a>
                ) : (
                  <span class="breadcrumb-item breadcrumb-current" aria-current="page">{item.label}</span>
                )}
              </li>
            ))}
          </ol>
        </div>
      </div>
    </nav>
  )}

  <!-- Mobile Navigation -->
  <nav id="mobile-menu" class="hidden md:hidden bg-white border-t max-h-[calc(100vh-88px)] overflow-y-auto" aria-label="Mobile navigation">
    <ul class="px-4 py-4 space-y-1" role="menu">
      {navItems.map((item) => (
        <li class="border-b border-gray-100 last:border-b-0" role="none">
          <a href={item.href} class="block py-3 px-2 text-gray-700 font-medium min-h-[44px] flex items-center" role="menuitem">{item.label}</a>
          {item.children && (
            <ul class="pl-4 pb-2 space-y-1" role="menu" aria-label={`${item.label} submenu`}>
              {item.children.map((child) => (
                <li role="none">
                  <a href={child.href} class="block py-2.5 px-2 text-sm text-gray-600 hover:text-[#2D8B4E] min-h-[44px] flex items-center" role="menuitem">
                    {child.label}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))}
      <li role="none">
        <a href="/donate" class="block w-full bg-[#F7931E] text-white px-4 py-3.5 rounded-lg text-center font-semibold mt-4 min-h-[48px] flex items-center justify-center" role="menuitem">
          Donate
        </a>
      </li>
    </ul>
  </nav>
</header>

<style>
  /* Dropdown menu styles */
  .dropdown-menu {
    position: absolute;
    left: -1rem;
    top: 100%;
    width: 14rem;
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    padding: 0.5rem 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-4px);
    transition: all 0.2s ease;
    z-index: 50;
  }

  /* Bridge element to prevent hover gap */
  .dropdown-menu::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 0;
    right: 0;
    height: 10px;
  }

  .group:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .breadcrumb-bar {
    background: linear-gradient(135deg, rgba(45, 139, 78, 0.12), rgba(247, 147, 30, 0.08));
    border-bottom: 1px solid rgba(45, 139, 78, 0.1);
    width: 100%;
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.3s ease;
    backdrop-filter: blur(8px);
  }

  .breadcrumb-bar-inner {
    padding: 0.625rem 0;
  }

  .header-wrapper.scrolled .breadcrumb-bar {
    max-height: 50px;
  }

  .breadcrumb-content {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .breadcrumb-item {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.8125rem;
    color: #6b7280;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  a.breadcrumb-item:hover {
    color: #2D8B4E;
  }

  .breadcrumb-home svg {
    color: #2D8B4E;
  }

  .breadcrumb-separator {
    width: 0.875rem;
    height: 0.875rem;
    color: #d1d5db;
    flex-shrink: 0;
  }

  .breadcrumb-current {
    color: #111827;
    font-weight: 600;
  }
</style>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  const header = document.querySelector('.header-wrapper');

  button?.addEventListener('click', () => {
    const isExpanded = button.getAttribute('aria-expanded') === 'true';
    button.setAttribute('aria-expanded', (!isExpanded).toString());
    button.setAttribute('aria-label', isExpanded ? 'Open navigation menu' : 'Close navigation menu');
    menu?.classList.toggle('hidden');
  });

  // Close mobile menu when clicking outside
  document.addEventListener('click', (e) => {
    if (menu && button && !menu.contains(e.target as Node) && !button.contains(e.target as Node)) {
      menu.classList.add('hidden');
      button.setAttribute('aria-expanded', 'false');
      button.setAttribute('aria-label', 'Open navigation menu');
    }
  });

  // Close mobile menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && menu && !menu.classList.contains('hidden')) {
      menu.classList.add('hidden');
      button?.setAttribute('aria-expanded', 'false');
      button?.setAttribute('aria-label', 'Open navigation menu');
      button?.focus();
    }
  });

  // Show breadcrumb bar on scroll
  let lastScroll = 0;
  const scrollThreshold = 300;

  function handleScroll() {
    const currentScroll = window.scrollY;

    if (currentScroll > scrollThreshold) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }

    lastScroll = currentScroll;
  }

  window.addEventListener('scroll', handleScroll, { passive: true });
  handleScroll(); // Check initial state
</script>
